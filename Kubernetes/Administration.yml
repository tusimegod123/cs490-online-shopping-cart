apiVersion: apps/v1
kind: Deployment
metadata:
  name: administration-service
  labels:
    app: administration-service
spec:
  replicas: 1
  selector:
    matchLabels:
      app: administration-service
  template:
    metadata:
      labels:
        app: administration-service
    spec:
      containers:
      - name: administration-service
        image: tusimegodwin256/administration-module # Replace with your image name and tag
        imagePullPolicy: Always
        ports:
          - containerPort: 9898
        env:
        - name: DB_HOST
          value: mysql
        - name: DB_USERNAME
          value: root
        - name: MYSQL_ROOT_PASSWORD
          value: gold
        - name: MYSQL_DATABASE
          value: cs490-swe-2023-administrator # Replace with your MySQL database name
        # - name: SPRING_PROFILES_ACTIVE
        #   value: dev # Replace with your Spring profile
        # - name: EUREKA_INSTANCE_HOSTNAME
        #   valueFrom:
        #     fieldRef:
        #       fieldPath: status.podIP
        # - name: EUREKA_INSTANCE_NONSECUREPORT
        #   value: "9898"
        # - name: EUREKA_CLIENT_SERVICEURL_DEFAULTZONE
        #   value: http://eureka-server:8761/eureka/
---
apiVersion: v1
kind: Service
metadata:
  name: administration-service
spec:
  selector:
    app: administration-service
  ports:
   - port: 80
     targetPort: 9898
     protocol: TCP
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: administration-service-config
data:
  application.properties: |-
    spring.application.name=administration-service
    spring.datasource.url=jdbc:mysql://mysql:3306/cs490-swe-2023-administrator?useSSL=false
    spring.datasource.username=root
    spring.datasource.password=gold
    eureka.client.serviceUrl.defaultZone=http://eureka-server:8761/eureka/
    eureka.instance.nonSecurePort=8761
    eureka.instance.hostname=$(POD_IP)
    eureka.instance.preferIpAddress=true

# eureka:
#     client:
#         service-url:
#             defaultZone: http://eureka-server:8761/eureka
#         fetch-registry: true
#         register-with-eureka: true
#         enabled: false
